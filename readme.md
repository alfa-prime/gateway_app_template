# –®–∞–±–ª–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —à–ª—é–∑–∞ –ï–í–ú–ò–ê–° API

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Å–æ —à–ª—é–∑–æ–º –ï–í–ú–ò–ê–° API. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ API-–∫–ª—é—á—É.

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–æ—É—Ç `/health`, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø—Ä–æ–≤–µ—Ä–∫—É —Å–≤—è–∑–∏ —Å–æ —à–ª—é–∑–æ–º.

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

- Git  
- Docker  
- Docker Compose  

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –ø–∞–ø–∫—É —Å –∂–µ–ª–∞–µ–º—ã–º –∏–º–µ–Ω–µ–º –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `my_super_app`).

```bash
git clone ssh://git@gitverse.ru:2222/imperium/gateway_app_template.git my_super_app
```

–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å `my_super_app`, –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –≤ –ø–∞–ø–∫—É `gateway_app_template`.

---

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd my_super_app

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env
cp .env.example .env
```

**–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç:**

`GATEWAY_API_KEY`: –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ —à–ª—é–∑—É.

`DEV_CONTAINER_NAME` –∏ `PROD_CONTAINER_NAME`: –ó–∞–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

`DEV_PORT` –∏ `PROD_PORT`: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ.


```dotenv
# .env
GATEWAY_URL=http://192.168.0.249:8777/
GATEWAY_API_KEY=–≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-–∫–ª—é—á-–¥–æ—Å—Ç—É–ø–∞
GATEWAY_REQUEST_ENDPOINT=gateway/request

# –ò–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
DEV_CONTAINER_NAME=my_super_app
PROD_CONTAINER_NAME=my_super_app_prod

# –ü–æ—Ä—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã
DEV_PORT=8000
PROD_PORT=8778
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å live-reload):**

```bash
make up
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:  
üëâ [http://localhost:8000](http://localhost:8000)

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**

```bash
make up-prod
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:  
üëâ [http://localhost:8778](http://localhost:8778)

---

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (makefile)

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

| –ö–æ–º–∞–Ω–¥–∞     | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|
| `make up`   | –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. |
| `make down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. |
| `make bash` | –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é bash –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. |

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω

| –ö–æ–º–∞–Ω–¥–∞         | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------------|----------|
| `make up-prod`  | –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (production). |
| `make down-prod`| –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞. |
| `make logs-prod`| –ü–æ–∫–∞–∑–∞—Ç—å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. |
| `make bash-prod`| –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é bash –≤–Ω—É—Ç—Ä–∏ prod-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. |

### –û–±—â–∏–µ

| –ö–æ–º–∞–Ω–¥–∞      | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------|
| `make clean` | –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker-–æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Ç–æ–º–∞ –∏ —Å–µ—Ç–∏. |

---

## GatewayService

–î–ª—è –ª—é–±–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–æ —à–ª—é–∑–æ–º –ï–í–ú–ò–ê–° –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω `GatewayService`.  
–ï–≥–æ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –ª—é–±–æ–º —Ä–æ—É—Ç–µ—Ä–µ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π **FastAPI**.  
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –µ–¥–∏–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ `.env` —Ñ–∞–π–ª–µ (`GATEWAY_REQUEST_ENDPOINT`).

–°–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –æ–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
make_request(method: str, **kwargs)
```

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã –º–µ—Ç–æ–¥–∞

- **method**: HTTP-–º–µ—Ç–æ–¥ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ (`'post'`, `'get'`, `'put'` –∏ —Ç.–¥.).  
- **kwargs**: –õ—é–±—ã–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∫–ª–∏–µ–Ω—Ç **httpx**.  
  –°–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –∏–∑ –Ω–∏—Ö:
  - `json=<dict>` ‚Äî –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `POST`, `PUT`, `PATCH`).
  - `params=<dict>` ‚Äî –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ URL (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `GET`).

---

### –ü—Ä–∏–º–µ—Ä 1: POST-–∑–∞–ø—Ä–æ—Å (—Å–∞–º—ã–π —á–∞—Å—Ç—ã–π —Å–ª—É—á–∞–π)

```python
# –í –≤–∞—à–µ–º —Ñ–∞–π–ª–µ —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, app/route/my_new_route.py
from fastapi import APIRouter, Depends
from app.core import get_gateway_service
from app.service import GatewayService
from typing import Annotated

router = APIRouter(prefix="/entities", tags=["Entities"])

@router.post("/")
async def create_entity(
    gateway_service: Annotated[GatewayService, Depends(get_gateway_service)]
):
    payload = {
        "params": {"c": "SomeClass", "m": "someMethod"},
        "data": {"name": "New Entity", "value": 123}
    }
    
    # –í—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å, —É–∫–∞–∑—ã–≤–∞—è –º–µ—Ç–æ–¥ 'post' –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—è –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ 'json'
    response_data = await gateway_service.make_request('post', json=payload)
    
    return response_data
```

---

### –ü—Ä–∏–º–µ—Ä 2: GET-–∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```python
# ... (–∏–º–ø–æ—Ä—Ç—ã —Ç–µ –∂–µ)

@router.get("/")
async def get_entities_list(
    gateway_service: Annotated[GatewayService, Depends(get_gateway_service)]
):
    query_params = {
        "entity_type": "user",
        "status": "active"
    }
    
    # –í—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å —Å –º–µ—Ç–æ–¥–æ–º 'get' –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ 'params'
    response_data = await gateway_service.make_request('get', params=query_params)
    
    return response_data
```



## –¢–µ—Å—Ç–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç (/health)

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å–≤—è–∑–∏ —Å–æ —à–ª—é–∑–æ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.  
–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –≤–∞—à `X-API-KEY` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

**–ó–∞–ø—Ä–æ—Å:**

```bash
curl -X GET http://localhost:8000/health/   -H "X-API-KEY: –≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-–∫–ª—é—á-–¥–æ—Å—Ç—É–ø–∞"
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "ping": "pong"
}
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ —Å–æ —à–ª—é–∑–æ–º –ï–í–ú–ò–ê–°

**–ó–∞–ø—Ä–æ—Å:**

```bash
curl -X POST http://localhost:8000/health/gateway   -H "X-API-KEY: –≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-–∫–ª—é—á-–¥–æ—Å—Ç—É–ø–∞"
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç —à–ª—é–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —à–ª—é–∑–∞).

```json
{
  "data": {
    "current_datetime": "2024-09-07T12:00:00.000Z"
  },
  "success": true
}
```
